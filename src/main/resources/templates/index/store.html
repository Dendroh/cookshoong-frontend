<!DOCTYPE html>
<html data-bs-theme="light" lang="en" data-bss-forced-theme="light"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{config}">
<head>
    <title>Untitled</title>
</head>
<body layout:fragment="content">
<header th:replace="fragments :: user-site-header"></header>
<div th:replace="fragments :: business-store-list"></div>
<div class="container-fluid page-body-wrapper">
    <div class="landing-panel">
        <div class="content-wrapper">
            <section class="container">
                <div class="row flex-xl-nowrap" style="border: 1px solid #e7eaed;">
                    <div class="card border-0" style="width: 200px; height: 200px;">
                        <div class="card-body">
                            <div class="bg-box p-4 text-center" style="background-color: #ffffff;">
                                <div style="background-color: #232325; width: 150px; height: 150px;">
                                    <img style="max-width: 100%; max-height: 100%;" th:src="${store.getSavedName()}"
                                         onerror="this.onerror=null; this.src='/assets/images/nodata.png';">
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="card border-0 flex-fill">
                        <span class="card-header font-weight-bold border-0 bg-white" style="font-size: 40px;"
                              th:text="${store.storeName}"></span>
                        <p style="padding-left: 1.25rem; padding-right: 1.25rem;"><strong>배달 시간 : </strong>60분</p>
                        <p style="padding-left: 1.25rem; padding-right: 1.25rem;"><strong>배달 비용 : </strong>4000원</p>
                        <p style="padding-left: 1.25rem; padding-right: 1.25rem;"><strong>최소 주문 : </strong>15000원</p>
                        <p style="padding-left: 1.25rem; padding-right: 1.25rem;"><strong>가게 위치 : </strong>400m</p>
                        <span class="m-3 pt-1 pb-1"
                              style="height: auto; padding-left: 1.25rem; padding-right: 1.25rem; border-radius: 1rem; background-color: whitesmoke"
                              th:utext="${store.description}">
                        </span>
                        <div class="col-12 d-flex">
                            <button class="flex-grow-1 border-bottom border-left border-right border-top bg-white m-2"
                                    style="height: 40px; border-radius: 1rem">
                                리뷰 보기
                            </button>
                            <button class="flex-grow-1 border-bottom border-left border-right border-top bg-white m-2"
                                    style="height: 40px; border-radius: 1rem">
                                가게 정보
                            </button>
                        </div>
                    </div>

                </div>

                <div class="card">
                    <div class="row p-2">
                        <div th:each="policy : ${store.provableCouponPolicies}" class="col-12 col-xl-4" style="max-width: 400px;">
                            <div class="w-100">
                                <form th:action="@{/coupon/provide}" th:method="post">
                                    <button class="btn btn-outline-warning mr-2 provide-button w-100 pl-2 pr-2"
                                            th:data-policy-id="${policy.couponPolicyId}" type="submit"
                                            style="border-radius: 6px; border-width: 6px; height: 160px;">
                                        <div class="col-sm-12 text-left notification-container" style="font-size: 20px; font-weight: bold"
                                             th:switch="${policy.couponTypeResponse.getClass().getSimpleName()}">

                                            <div th:case="CouponTypeCashVo">
                                                <span th:text="'고정 할인'" style="font-weight: bold"></span>
                                                <h1 class="font-weight-bold pt-2 grad-text" style="font-size: 40px;"
                                                    th:text="${policy.couponTypeResponse.discountAmount} + '원 할인'"></h1>

                                                <div style="height: 60px;">
                                                    <p th:text="'사용 가능 기간: ' + ${policy.usagePeriod} + '일 후 까지'"></p>
                                                    <p th:text="'최소 ' + ${policy.couponTypeResponse.minimumOrderPrice} + '원 부터 적용'"></p>
                                                </div>
                                            </div>

                                            <div th:case="CouponTypePercentVo">
                                                <span th:text="'퍼센트 할인'" style="font-weight: bold"></span>
                                                <h1 class="font-weight-bold pt-2 grad-text" style="font-size: 40px;"
                                                    th:text="${policy.couponTypeResponse.rate} + '% 할인'"></h1>

                                                <div style="height: 60px;">
                                                    <p th:text="'사용 가능 기간: ' + ${policy.usagePeriod} + '일 후 까지'"></p>
                                                    <p th:text="'최소 ' + ${policy.couponTypeResponse.minimumOrderPrice} + '원 부터 적용'
                                                    + ' (최대 ' + ${policy.couponTypeResponse.maximumDiscountAmount} + '원 까지)'"></p>
                                                </div>
                                            </div>

                                            <input type="hidden" name="couponPolicyId" th:value="${policy.couponPolicyId}">
                                        </div>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-bottom-0">
                    <ul class="nav nav-tabs col-12 m-0 p-0">
                        <li class="nav-item flex-grow-1" style="text-align: center">
                            <a class="nav-link active" href="#all" data-toggle="tab">모두 보기</a>
                        </li>
                        <li class="nav-item flex-grow-1" style="text-align: center"
                            th:each="menuGroup, i:${menuGroups}">
                            <a class="nav-link" th:href="'#group'+${menuGroup.id}" data-toggle="tab"
                               th:text="${menuGroup.name}"></a>
                        </li>
                    </ul>
                </div>

                <div class="card border-top-0">
                    <div class="tab-content p-0 m-0">
                        <div class="tab-pane fade show active stretch-card" id="all">
                            <div class="card border-0">
                                <div class="card-body p-3">
                                    <h3 class="font-weight-bold mb-3">모두 보기</h3>
                                    <div class="pr-0" th:each="menu, i:${menus}">
                                        <button class="row flex-sm-nowrap border-top border-bottom border-left border-right pt-2 mt-1 mb-1 w-100 bg-white"
                                                style="border-radius: 5px;"
                                                th:onclick="'window.location.href=\'/index/store/' + ${menu.storeId} + '/menu/' + ${menu.id}+'\''">

                                            <div class="align-content-end border-info pr-3 pb-2">
                                                <img th:src="${menu.getSavedName()}"
                                                     onerror="this.onerror=null; this.src='/assets/images/nodata.png';"
                                                     style="object-fit: cover; width: 150px; height: 150px;">
                                            </div>

                                            <div class="flex-fill">
                                                <p>
                                                <h3 style="text-align: left" th:text="${menu.name}"></h3>
                                                </p>
                                                <p style="text-align: left">
                                                    <i class="mdi mdi mdi-file-powerpoint-box"
                                                       style="color: orange; font-size: 1.1rem"></i>
                                                    <span class="pr-2" style="font-size: 1.2rem"
                                                          th:text="${menu.earningRate} + '%'"></span>
                                                    <i class="mdi mdi mdi-timer icon-sm"
                                                       style="color: grey"></i>
                                                    <span class="pr-2" style="font-size: 1.2rem"
                                                          th:text="${menu.cookingTime} + '분'"></span>
                                                </p>
                                                <div class="pt-2 text-left">
                                                    <p class="font-weight-bold" style="font-size: 1.3rem"
                                                       th:text="${menu.price} + ' 원'"></p>
                                                </div>
                                                <div class="pt-1 text-left" style="min-width: 280px;">
                                                    <p th:utext="${menu.description}"></p>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade stretch-card" th:each="menuGroup, i:${menuGroups}"
                             th:id="${'group'+menuGroup.id}">
                            <div class="card border-0">
                                <div class="card-body p-3">
                                    <h3 class="font-weight-bold mb-3" th:text="${menuGroup.name}"></h3>
                                    <div class="pr-0" th:each="menu, i:${menus}"
                                         th:if="${menu.menuGroups.contains(menuGroup.id)}">
                                        <button class="row flex-sm-nowrap border-top border-bottom border-left border-right pt-2 mt-1 mb-1 w-100 bg-white"
                                                style="border-radius: 5px;"
                                                th:onclick="'window.location.href=\'/index/store/' + ${menu.storeId} + '/menu/' + ${menu.id}+'\''">
                                            <div class="align-content-end border-info pr-3 pb-2">
                                                <img th:src="${menu.getSavedName()}"
                                                     onerror="this.onerror=null; this.src='/assets/images/nodata.png';"
                                                     style="object-fit: cover; width: 150px; height: 150px;">
                                            </div>
                                            <div class="flex-fill">
                                                <p>
                                                <h3 style="text-align: left" th:text="${menu.name}"></h3>
                                                </p>
                                                <p style="text-align: left">
                                                    <i class="mdi mdi mdi-file-powerpoint-box"
                                                       style="color: orange; font-size: 1.1rem"></i>
                                                    <span class="pr-2" style="font-size: 1.2rem"
                                                          th:text="${menu.earningRate} + '%'"></span>
                                                    <i class="mdi mdi mdi-timer icon-sm"
                                                       style="color: grey"></i>
                                                    <span class="pr-2" style="font-size: 1.2rem"
                                                          th:text="${menu.cookingTime} + '분'"></span>
                                                </p>
                                                <div class="pt-2 text-left">
                                                    <p class="font-weight-bold" style="font-size: 1.3rem"
                                                       th:text="${menu.price} + ' 원'"></p>
                                                </div>
                                                <div class="pt-1 text-left" style="min-width: 280px;">
                                                    <p th:utext="${menu.description}"></p>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
<footer th:replace="fragments :: site-footer"></footer>
<script>
    window.onload = function () {
        window.scrollTo(0, 0);
    }

    $('.provide-button').click(function (event) {
        event.preventDefault();
        const button = $(this);
        const form = button.closest('form');

        button.prop('disabled', true);

        $.post(form.attr('action'), form.serialize(), function (response) {
            if (response === "ok") {
                showNotification(button, "쿠폰이 발급되었습니다!");
            } else {
                showNotification(button, response);
            }
        });
    });

    function showNotification(button, message) {
        button.find('.notification-container').text(message);
    }
</script>
</body>
</html>
