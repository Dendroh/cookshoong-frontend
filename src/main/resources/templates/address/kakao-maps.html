<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>주소와 좌표 생성</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=55b38bb80852c12b35f14456e76868a9&libraries=services"></script>
</head>
<body>
<h1>주소와 좌표 생성</h1>
<form th:action="@{${url}}" method="POST" id="addressForm" th:object="${address}">
    <tr>
        <td>
            <input type="text" id="addressInput" name="mainPlace" th:field="*{mainPlace}" placeholder="주소">
            <input type="hidden" id="latitudeInput" name="latitude" th:field="*{latitude}">
            <input type="hidden" id="longitudeInput" name="longitude" th:field="*{longitude}">
            <input type="button" onclick="execDaumPostcode()" value="주소 검색">
            <br>
            <input type="text" id="alias" name="alias" th:field="*{alias}" placeholder="별칭">
            <br>
            <input type="text" id="detailAddress" name="detailPlace" th:field="*{detailPlace}" placeholder="상세주소">
        </td>
    </tr>
    <br>
    <input type="submit" value="주소와 좌표 저장">
</form>

<table>
    <thead>
    <tr>
        <th>별칭</th>
        <th>메인 주소</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="a : ${accountAddresses}">
        <td th:text="${a.getAlias()}">별칭</td>
        <td th:text="${a.getMainAddress()}">메인 주소</td>
        <td>
            <button th:onclick="'location.href=\'' + @{|/addresses/maps/address/${a.id}/delete|} + '\''">삭제</button>
        </td>
    </tr>
    </tbody>
</table>

<div id="map" style="width: 300px; height: 300px; margin-top: 10px; display: none;"></div>

<script>
    var mapContainer = document.getElementById('map');
    var mapOption = {
        center: new daum.maps.LatLng(37.537187, 127.005476),
        level: 5
    };
    var map = new daum.maps.Map(mapContainer, mapOption);
    var geocoder = new daum.maps.services.Geocoder();
    var marker = new daum.maps.Marker({
        position: new daum.maps.LatLng(37.537187, 127.005476),
        map: map
    });

    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = data.address;
                document.getElementById("addressInput").value = addr;
                geocoder.addressSearch(data.address, function(results, status) {
                    if (status === daum.maps.services.Status.OK) {
                        var result = results[0];
                        var lat = result.y;
                        var lng = result.x;
                        document.getElementById("latitudeInput").value = lat;
                        document.getElementById("longitudeInput").value = lng;
                        mapContainer.style.display = "block";
                        map.relayout();
                        map.setCenter(new daum.maps.LatLng(lat, lng));
                        marker.setPosition(new daum.maps.LatLng(lat, lng));
                    }
                });
            }
        }).open();
    }
</script>
</body>
</html>
